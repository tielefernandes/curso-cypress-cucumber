# _Tags_

Uma funcionalidade bastante útil do Cucumber é a possibilidade de colocar _tags_ nos cenários, e então, executá-los por suas _tags_ específicas.

Isso permite a criação de abordagens como a definição de quais cenários farão parte da suíte de _smoke tests_ e quais farão parte dos testes de regressão, possibilitando a criação de uma esteira de integração contínua otimizada.

Nesta esteira de integração contínua otimizada, primeiro, executamos uma suíte de testes menor, só com os testes mais importantes (os _smoke tests_).

E só se os _smoke tests_ passam, radamos então os cenários seguintes de regressão.

Ou seja, se a esteira falhar nos _smoke tests_, não perdemos tempo esperando toda a bateria de regressão rodar, dando _feedback_ rápido aos times.

Para definir tags com Cucumber, usamos a arroba - `@` (ex. `@smoke`).

Vejamos um exemplo.

```feature
# cypress/e2e/login.feature

Feature: Login
  Background: access the Login form
    Given I access the Login form

  @smoke
  Scenario: successful login
    When I submit it with valid credentials
    Then I see the logged-in features available

  Scenario: invalid password
    When I submit it with a valid user but an invalid password
    Then I am not allowed to login
    And I see an error message (The provided username or password are invalid!)

  Scenario: blocked user
    When I submit it with valid credentials of a blocked user
    Then I am not allowed to login
    And I see an error message (User locked out!)
```

> 👨‍🏫 Visto que o cenário de sucesso do login é o mais importante, usamos a _tag_ `@smoke` nele.

## Configuração extra para filtrar _tags_

Para filtrar os arquivos que precisam ser executados quando usando _tags_, basta adicionar a seguinte configuração no arquivo `cypress.config.js`, dentro da propriedade `e2e`.

🙊 Assim:

```js
env: {
  omitFiltered: true,
  filterSpecs: true
},
```

> 👨‍🏫 Quando configurada como `true`, a propriedade `omitFiltered`, como o nome sugere, omite testes filtrados no _output_ da execução dos testes na linha de comando.
>
> E a propriedade `filterSpecs` (também quando configurada como `true`) possibilita filtar os arquivos antes mesmo da execução, otimizando a mesma, visto que somente arquivos que possuem certa tag são executados.

## Executando testes por suas _tags_

Depois de adicionarmos _tags_ nos cenários, podemos então rodar os testes por suas _tags_.

Para executar os testes que possuem certa _tag_, usamos o seguinte comando `npx cypress run --env tags='@tag-here'`

Para executar os testes que NÃO possuem certa _tag_, usamos o seguinte comando `npx cypress run --env tags='not @tag-here'`

> 👨‍🏫 Perceba a palavra **_not_**!

Além disso, podemos definir _npm scripts_ no arquivo `package.json` para a execução de tais comandos.

🙊 Algo assim:

```json
"scripts": {
  "test:smoke": "cypress run --env tags='@smoke'",
  "test:not:smoke": "cypress run --env tags='not @smoke'",
  "test:engagesphere": "cypress run --env tags='@engagesphere'",
  "test:hackerstories": "cypress run --env tags='@hackerstories'"
},
```

E em uma esteira de integração contínua, podemos criar um fluxo onde primeiro os _smoke tests_ executam, e só se passam, rodamos os _not smoke_ (o resto da suíte de regressão).

## Exercício 🎯

1. Atualize os arquivos de _feature_ com _tags_ para experimentar

> 👨‍🏫 Recomendo escolher alguns testes para a suíte de _smoke tests_, além de adicionar _tags_ para as diferentes aplicações (🙊 `@engagesphere` e `@hackerstories`).

2. Atualize a seção de `scripts` do arquivo `package.json` com atalhos para a execução dos testes por suas diferentes _tags_
3. Atualize o arquivo `cypress.config.js` para que filtre os arquivos pela _tag_ sendo executada, conforme demonstrado acima
4. Por fim, execute os testes por suas diferentes _tags_ para experimentar.

## Mostre ao mundo o que você aprendeu 🌎

Para mostrar à sua rede profissional o que você aprendeu nesta aula, publique o seguinte no LinkedIn.

> Estou fazendo o curso "Testes End-to-End com Cypress e Cucumber: Guia Definitivo 🥒" da escola online Talking About Testing, onde aprendi a definir e executar cenários de teste por suas _tags_ específicas. #TalkingAboutTesting #EscolaTAT #Cypress #Cucumber
>
> 👨‍🏫 Lembre-se de me marcar em sua publicação. [Aqui está meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

Agora que você sabe usar _tags_, [vamos aprender como gerar um relatório HTML de execução dos testes](./11.md).

___

[Voltar para a página inicial](../README.md)
